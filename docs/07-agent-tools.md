# Agent Tools

> æœ¬æ–‡æ¡£æè¿° Deca Agent çš„å·¥å…·ç³»ç»Ÿã€æµ‹è¯•è¦†ç›–æƒ…å†µå’Œæ”¹è¿›è®¡åˆ’

## æ¦‚è¿°

Deca Agent ç›®å‰å®ç°äº† **9 ä¸ªå†…ç½®å·¥å…·**ï¼Œè¦†ç›– Agent ä¸å¤–éƒ¨ä¸–ç•Œäº¤äº’çš„æ ¸å¿ƒèƒ½åŠ›ã€‚

å·¥å…·å®šä¹‰ä½äºï¼š`packages/agent/src/tools/builtin.ts`

## å·¥å…·æ¸…å•

### èƒ½åŠ›çŸ©é˜µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Agent èƒ½åŠ›å±‚                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æ„ŸçŸ¥å±‚    â”‚    è¡ŒåŠ¨å±‚     â”‚    è®°å¿†å±‚     â”‚   ç¼–æ’å±‚     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ read        â”‚ write         â”‚ memory_search â”‚ sessions_spawnâ”‚
â”‚ list        â”‚ edit          â”‚ memory_get    â”‚              â”‚
â”‚ grep        â”‚ exec          â”‚               â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å·¥å…·è¯¦æƒ…

| å·¥å…· | ç±»åˆ« | åŠŸèƒ½ | é™åˆ¶ |
|------|------|------|------|
| **read** | æ„ŸçŸ¥ | è¯»å–æ–‡ä»¶å†…å®¹ï¼ˆå¸¦è¡Œå·ï¼‰ | é»˜è®¤ 500 è¡Œ |
| **write** | è¡ŒåŠ¨ | å†™å…¥/åˆ›å»ºæ–‡ä»¶ï¼ˆè¦†ç›–æ¨¡å¼ï¼‰ | è‡ªåŠ¨åˆ›å»ºçˆ¶ç›®å½• |
| **edit** | è¡ŒåŠ¨ | å­—ç¬¦ä¸²æ›¿æ¢ç¼–è¾‘ | åªæ›¿æ¢ç¬¬ä¸€ä¸ªåŒ¹é… |
| **exec** | è¡ŒåŠ¨ | æ‰§è¡Œ shell å‘½ä»¤ | 30s è¶…æ—¶ï¼Œ30KB è¾“å‡º |
| **list** | æ„ŸçŸ¥ | åˆ—å‡ºç›®å½•å†…å®¹ | æœ€å¤š 100 æ¡ |
| **grep** | æ„ŸçŸ¥ | æœç´¢æ–‡ä»¶å†…å®¹ï¼ˆæ­£åˆ™ï¼‰ | æœ€å¤š 50 æ¡ç»“æœ |
| **memory_search** | è®°å¿† | æ£€ç´¢é•¿æœŸè®°å¿†ç´¢å¼• | é»˜è®¤è¿”å› 5 æ¡ |
| **memory_get** | è®°å¿† | æŒ‰ ID è¯»å–å®Œæ•´è®°å¿† | - |
| **sessions_spawn** | ç¼–æ’ | å¯åŠ¨å­ä»£ç†æ‰§è¡Œåå°ä»»åŠ¡ | - |

---

## å·¥å…·å®ç°

### read - æ–‡ä»¶è¯»å–

```typescript
// è¾“å…¥
{ file_path: string; limit?: number }

// è¾“å‡ºæ ¼å¼
"1\tç¬¬ä¸€è¡Œå†…å®¹\n2\tç¬¬äºŒè¡Œå†…å®¹\n..."
```

**è®¾è®¡è€ƒé‡ï¼š**
- å¸¦è¡Œå·æ–¹ä¾¿ LLM å¼•ç”¨å…·ä½“ä½ç½®
- é™åˆ¶ 500 è¡Œé˜²æ­¢å ç”¨è¿‡å¤šä¸Šä¸‹æ–‡
- è·¯å¾„åŸºäº workspaceDirï¼Œé˜²æ­¢è¶Šç•Œè®¿é—®

### write - æ–‡ä»¶å†™å…¥

```typescript
// è¾“å…¥
{ file_path: string; content: string }

// è¾“å‡º
"æˆåŠŸå†™å…¥ xxx" æˆ– "é”™è¯¯: ..."
```

**è®¾è®¡è€ƒé‡ï¼š**
- è‡ªåŠ¨åˆ›å»ºçˆ¶ç›®å½•ï¼ˆrecursive: trueï¼‰
- è¦†ç›–æ¨¡å¼ï¼Œè¿½åŠ å¯ç”¨ edit å®ç°

### edit - æ–‡ä»¶ç¼–è¾‘

```typescript
// è¾“å…¥
{ file_path: string; old_string: string; new_string: string }

// è¾“å‡º
"æˆåŠŸç¼–è¾‘ xxx" æˆ– "é”™è¯¯: æœªæ‰¾åˆ°è¦æ›¿æ¢çš„æ–‡æœ¬"
```

**è®¾è®¡è€ƒé‡ï¼š**
- å­—ç¬¦ä¸²ç²¾ç¡®åŒ¹é…ï¼Œæ¯”æ­£åˆ™æ›´å¯é¢„æµ‹
- åªæ›¿æ¢ç¬¬ä¸€ä¸ªåŒ¹é…ï¼Œæ›´å¯æ§
- éœ€è¦ old_string ä¸æ–‡ä»¶å†…å®¹å®Œå…¨ä¸€è‡´ï¼ˆå«ç©ºæ ¼æ¢è¡Œï¼‰

### exec - å‘½ä»¤æ‰§è¡Œ

```typescript
// è¾“å…¥
{ command: string; timeout?: number }

// è¾“å‡º
stdout + stderrï¼ˆæˆªå–å‰ 30KBï¼‰
```

**è®¾è®¡è€ƒé‡ï¼š**
- é»˜è®¤ 30 ç§’è¶…æ—¶ï¼Œé˜²æ­¢å¡ä½
- maxBuffer 1MBï¼Œè¿”å›æˆªå– 30KB
- cwd è®¾ç½®ä¸º workspaceDir

**å®‰å…¨è­¦å‘Šï¼š** å½“å‰æ— æ²™ç®±ï¼Œç”Ÿäº§ç¯å¢ƒåº”ä½¿ç”¨ Docker éš”ç¦»

### list - ç›®å½•åˆ—è¡¨

```typescript
// è¾“å…¥
{ path?: string; pattern?: string }

// è¾“å‡º
"ğŸ“ subdir\nğŸ“„ file.ts\n..."
```

**è®¾è®¡è€ƒé‡ï¼š**
- å›¾æ ‡åŒºåˆ†æ–‡ä»¶/ç›®å½•
- é™åˆ¶ 100 æ¡é˜²æ­¢ node_modules çˆ†ç‚¸
- ç®€å•é€šé…ç¬¦è¿‡æ»¤

### grep - æ–‡ä»¶æœç´¢

```typescript
// è¾“å…¥
{ pattern: string; path?: string }

// è¾“å‡º
"file.ts:42:åŒ¹é…å†…å®¹\n..."
```

**è®¾è®¡è€ƒé‡ï¼š**
- ä½¿ç”¨ç³»ç»Ÿ grepï¼Œæ€§èƒ½å¥½
- åªæœç´¢ .ts/.js/.json/.md æ–‡æœ¬æ–‡ä»¶
- é™åˆ¶ 50 æ¡ç»“æœï¼Œ10 ç§’è¶…æ—¶

### memory_search - è®°å¿†æ£€ç´¢

```typescript
// è¾“å…¥
{ query: string; limit?: number }

// è¾“å‡º
"1. [mem-id] score=0.95 tags=tag1,tag2\n   snippet..."
```

**è®¾è®¡è€ƒé‡ï¼š**
- è¿”å›æ‘˜è¦åˆ—è¡¨ï¼Œæ§åˆ¶ä¸Šä¸‹æ–‡ä½“ç§¯
- æ”¯æŒ onMemorySearch å›è°ƒç”¨äºç»Ÿè®¡

### memory_get - è®°å¿†è¯»å–

```typescript
// è¾“å…¥
{ id: string }

// è¾“å‡º
"[mem-id] å®Œæ•´è®°å¿†å†…å®¹..."
```

**è®¾è®¡è€ƒé‡ï¼š**
- é…åˆ memory_search ä½¿ç”¨
- å…ˆæœç´¢ï¼Œå†æŒ‰éœ€æ‹‰å–å®Œæ•´å†…å®¹

### sessions_spawn - å­ä»£ç†è§¦å‘

```typescript
// è¾“å…¥
{ task: string; label?: string; cleanup?: "keep" | "delete" }

// è¾“å‡º
"å­ä»£ç†å·²å¯åŠ¨: runId=xxx sessionKey=yyy"
```

**è®¾è®¡è€ƒé‡ï¼š**
- å…è®¸ä¸»ä»£ç†å°†ä»»åŠ¡æ‹†åˆ°åå°
- å­ä»£ç†å®Œæˆåç”±ç³»ç»Ÿå›ä¼ æ‘˜è¦

---

## æµ‹è¯•è¦†ç›–

### å•å…ƒæµ‹è¯• (builtin.test.ts)

| å·¥å…· | ç”¨ä¾‹æ•° | è¦†ç›–åœºæ™¯ |
|------|--------|---------|
| **read** | 4 | âœ… å¸¦è¡Œå·è¯»å–ã€limit å‚æ•°ã€æ–‡ä»¶ä¸å­˜åœ¨é”™è¯¯ |
| **write** | 4 | âœ… å†™å…¥æ–‡ä»¶ã€è‡ªåŠ¨åˆ›å»ºçˆ¶ç›®å½•ã€è¦†ç›–å·²å­˜åœ¨æ–‡ä»¶ |
| **edit** | 5 | âœ… å­—ç¬¦ä¸²æ›¿æ¢ã€åªæ›¿æ¢ç¬¬ä¸€ä¸ªåŒ¹é…ã€æ–‡æœ¬æœªæ‰¾åˆ°é”™è¯¯ã€æ–‡ä»¶ä¸å­˜åœ¨é”™è¯¯ |
| **exec** | 4 | âœ… æ‰§è¡Œå‘½ä»¤ã€stderr è¾“å‡ºã€æ— æ•ˆå‘½ä»¤é”™è¯¯ã€åœ¨ workspaceDir æ‰§è¡Œ |
| **list** | 5 | âœ… åˆ—å‡ºå†…å®¹ã€pattern è¿‡æ»¤ã€å­ç›®å½•ã€ç©ºç›®å½•ã€ç›®å½•ä¸å­˜åœ¨é”™è¯¯ |
| **grep** | 3 | âœ… æœç´¢åŒ¹é…ã€æ— åŒ¹é…ã€ç©ºæœç´¢ |
| **memory_search** | 4 | âœ… æœªå¯ç”¨é”™è¯¯ã€æœç´¢ç»“æœã€æ— ç»“æœã€å›è°ƒè§¦å‘ |
| **memory_get** | 3 | âœ… æœªå¯ç”¨é”™è¯¯ã€æŒ‰ ID è·å–ã€æœªæ‰¾åˆ°é”™è¯¯ |
| **sessions_spawn** | 2 | âœ… æœªå¯ç”¨é”™è¯¯ã€å¯åŠ¨å­ä»£ç† |

**UT æ€»è®¡ï¼š~35 ä¸ªæµ‹è¯•ç”¨ä¾‹**

### E2E æµ‹è¯• (agent.e2e.test.ts)

ä½¿ç”¨çœŸå® LLM API è°ƒç”¨æµ‹è¯•ï¼š

| æµ‹è¯•ç±»åˆ« | è¦†ç›–å·¥å…· | åœºæ™¯ |
|---------|---------|------|
| **Basic** | - | å‡­è¯åŠ è½½ã€Agent åˆ›å»ºã€ç®€å•å¯¹è¯ |
| **Tools** | list | LLM è°ƒç”¨ list åˆ—ç›®å½• |
| | read | LLM è¯»å–æµ‹è¯•æ–‡ä»¶ |
| | write | LLM åˆ›å»ºæ–‡ä»¶ |
| | edit | LLM ä¿®æ”¹æ–‡ä»¶å†…å®¹ |
| | grep | LLM æœç´¢æ–‡ä»¶å†…å®¹ |
| | exec | LLM æ‰§è¡Œ shell å‘½ä»¤ |
| **Multi-turn** | read + write | å¤šè½®å·¥å…·è°ƒç”¨ä¿æŒä¸Šä¸‹æ–‡ |
| | list + read + write | å¤æ‚å¤šæ–‡ä»¶ä»»åŠ¡ |
| **Error Handling** | read | å¤„ç†æ–‡ä»¶ä¸å­˜åœ¨çš„ä¼˜é›…é™çº§ |
| **Streaming** | - | æµå¼å“åº” chunks æ­£ç¡® |
| **Prompt Loading** | - | IDENTITY.md / SOUL.md äººæ ¼åŠ è½½ |

### Heartbeat E2E æµ‹è¯• (heartbeat.e2e.test.ts)

| æµ‹è¯•ç±»åˆ« | åœºæ™¯ |
|---------|------|
| **Parsing** | è§£æ HEARTBEAT.md ä»»åŠ¡ã€ä¸åŒ checkbox æ ¼å¼ |
| **Trigger** | è§¦å‘å¿ƒè·³ã€è·³è¿‡æ— å¾…å¤„ç†ä»»åŠ¡ |
| **Task Management** | æ ‡è®°å®Œæˆã€æ·»åŠ æ–°ä»»åŠ¡ |
| **Agent Integration** | å¿ƒè·³ä»»åŠ¡é›†æˆåˆ° Agent å¯¹è¯ |

---

## æµ‹è¯•è¦†ç›–ç¼ºå£

### æœªè¦†ç›–åœºæ™¯

| å·¥å…· | ç¼ºå¤±æµ‹è¯•åœºæ™¯ | ä¼˜å…ˆçº§ |
|------|-------------|--------|
| **read** | å¤§æ–‡ä»¶ï¼ˆè¶… 500 è¡Œæˆªæ–­ï¼‰ã€äºŒè¿›åˆ¶æ–‡ä»¶å¤„ç† | Medium |
| **write** | å†™å…¥å¤±è´¥ï¼ˆæƒé™é—®é¢˜ï¼‰ã€å¹¶å‘å†™å…¥å†²çª | Low |
| **edit** | å¤šæ¬¡æ›¿æ¢åŒä¸€æ–‡ä»¶ã€ç‰¹æ®Šå­—ç¬¦ï¼ˆæ¢è¡Œã€åˆ¶è¡¨ç¬¦ï¼‰ | Medium |
| **exec** | è¶…æ—¶å¤„ç†ã€å¤§è¾“å‡ºæˆªæ–­ï¼ˆ30KBï¼‰ã€å±é™©å‘½ä»¤æ‹¦æˆª | High |
| **grep** | æ­£åˆ™è¯­æ³•é”™è¯¯ã€å¤§é‡åŒ¹é…æˆªæ–­ï¼ˆ50 æ¡ï¼‰ | Low |
| **memory_search** | çœŸå®è®°å¿†ç³»ç»Ÿé›†æˆï¼ˆç›®å‰åª mockï¼‰ | High |
| **memory_get** | çœŸå®è®°å¿†ç³»ç»Ÿé›†æˆï¼ˆç›®å‰åª mockï¼‰ | High |
| **sessions_spawn** | çœŸå®å­ä»£ç†æ‰§è¡Œï¼ˆç›®å‰åª mockï¼‰ | High |

### ç³»ç»Ÿçº§ç¼ºå£

| ç±»åˆ« | ç¼ºå¤± | ä¼˜å…ˆçº§ |
|------|------|--------|
| **å®‰å…¨** | è·¯å¾„è¶Šç•Œæµ‹è¯•ã€å‘½ä»¤æ³¨å…¥æµ‹è¯• | Critical |
| **æ€§èƒ½** | å¤§æ–‡ä»¶/å¤§ç›®å½•å‹åŠ›æµ‹è¯• | Medium |
| **å¹¶å‘** | å¤šå·¥å…·å¹¶è¡Œè°ƒç”¨ | Low |
| **é”™è¯¯æ¢å¤** | å·¥å…·å¤±è´¥å Agent è¡Œä¸º | Medium |

---

## æ”¹è¿›è®¡åˆ’

### Phase 1: è¡¥å……å…³é”®æµ‹è¯•

- [ ] exec è¶…æ—¶å’Œå±é™©å‘½ä»¤æµ‹è¯•
- [ ] è·¯å¾„è¶Šç•Œå®‰å…¨æµ‹è¯•
- [ ] memory_* çœŸå®ç³»ç»Ÿé›†æˆæµ‹è¯•

### Phase 2: Discord E2E é—­ç¯éªŒè¯

åˆ©ç”¨ [Discord E2E è°ƒè¯•æ¡†æ¶](06-e2e-discord-debugging.md) è¿›è¡ŒçœŸå®åœºæ™¯éªŒè¯ï¼š

- [ ] é€šè¿‡ Discord å‘é€ä»»åŠ¡ï¼ŒéªŒè¯å·¥å…·è°ƒç”¨é“¾è·¯
- [ ] è®¾è®¡è¾¹ç•Œæµ‹è¯•ç”¨ä¾‹ï¼ˆå¤§æ–‡ä»¶ã€è¶…æ—¶ã€é”™è¯¯å¤„ç†ï¼‰
- [ ] è‡ªåŠ¨åŒ–å›å½’æµ‹è¯•

### Phase 3: å·¥å…·æ‰©å±•

å‚è€ƒ OpenClawï¼ˆreferences/openclawï¼‰çš„ 50+ å·¥å…·ï¼ŒæŒ‰éœ€æ‰©å±•ï¼š

| ä¼˜å…ˆçº§ | å·¥å…·ç±»åˆ« | ç¤ºä¾‹ |
|--------|---------|------|
| High | Web æ“ä½œ | web_fetch, web_search |
| High | Git æ“ä½œ | git_status, git_commit |
| Medium | æµè§ˆå™¨è‡ªåŠ¨åŒ– | browser_* |
| Medium | å®šæ—¶ä»»åŠ¡ | cron_* |
| Low | å¹³å°é›†æˆ | discord_*, slack_* |

---

## ç›¸å…³æ–‡æ¡£

- [æµ‹è¯•è§„èŒƒ](04-testing.md) - é€šç”¨æµ‹è¯•ç­–ç•¥
- [Discord E2E è°ƒè¯•](06-e2e-discord-debugging.md) - é—­ç¯æµ‹è¯•æ–¹æ³•
- [ç³»ç»Ÿæ¶æ„](01-architecture.md) - æ•´ä½“æ¶æ„è®¾è®¡

## æ–‡ä»¶ç´¢å¼•

```
packages/agent/src/tools/
â”œâ”€â”€ index.ts          # æ¨¡å—å¯¼å‡º
â”œâ”€â”€ types.ts          # Tool/ToolContext ç±»å‹å®šä¹‰
â”œâ”€â”€ builtin.ts        # 9 ä¸ªå†…ç½®å·¥å…·å®ç°
â””â”€â”€ builtin.test.ts   # å•å…ƒæµ‹è¯• (~35 ç”¨ä¾‹)

packages/agent/src/e2e/
â”œâ”€â”€ agent.e2e.test.ts     # Agent E2E æµ‹è¯•ï¼ˆå«å·¥å…·æµ‹è¯•ï¼‰
â””â”€â”€ heartbeat.e2e.test.ts # Heartbeat E2E æµ‹è¯•
```
