# Pre-push: Run E2E tests with real services
# Requires:
#   ~/.deca/credentials/<provider>.json for Agent E2E (glm.json or minimax.json)
#   ~/.deca/credentials/discord.json with webhookUrl, testChannelId (for Discord E2E)

echo "üöÄ Running E2E tests before push..."

# Check Agent credentials (any LLM provider)
LLM_CRED_FOUND=false
for provider in glm minimax; do
  if [ -f "$HOME/.deca/credentials/${provider}.json" ]; then
    LLM_CRED_FOUND=true
    break
  fi
done

if [ "$LLM_CRED_FOUND" = false ]; then
  echo "‚ö†Ô∏è  Warning: No LLM credentials found"
  echo "   Agent E2E tests may fail."
  echo "   Expected: ~/.deca/credentials/glm.json or minimax.json"
fi

# Check Discord credentials
if [ ! -f "$HOME/.deca/credentials/discord.json" ]; then
  echo "‚ö†Ô∏è  Warning: No Discord credentials found"
  echo "   Discord E2E tests may fail."
fi

# Run E2E tests
bun run test:e2e

echo "‚úÖ E2E tests passed!"
